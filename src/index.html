<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <title>Vanilla JavaScript App!</title>
</head>

<body>
  <main>
    <h1>Vanilla JavaScript App</h1>
  </main>
  <script>
    async function validateIdToken(idToken) {
    // Azure AD B2CのOpenID設定を取得します
    const response = await fetch('https://onoderacorp.b2clogin.com/onoderacorp.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=B2C_1A_REDIRECTJUDGMENT_SIGNUP_SIGNIN');
    const openidConfig = await response.json();
    const keys = openidConfig.jwks_uri;

    // id_tokenをデコードします
    const decodedToken = jwt_decode(idToken);

    // ここで公開鍵とデコードしたトークンを使用して署名を検証するロジックを追加します
    // ブラウザでは署名の検証が難しいため、通常はサーバーサイドで行います

    return decodedToken;
    }

    
    // URLフラグメントを取得します
    const fragment = window.location.hash;

    // フラグメントが存在する場合、先頭の'#'を削除します
    if (fragment.startsWith('#')) {
        const params = new URLSearchParams(fragment.slice(1));

        // id_tokenを取得します
        const idToken = params.get('id_token');
        console.log(idToken);

        // Bingにリダイレクトします
        window.location.href = "https://www.bing.com";
        
        // id_tokenを検証します
        validateIdToken(idToken)
            .then(decodedToken => {
                console.log(decodedToken);
            })
            .catch(err => {
                console.error('Token validation failed', err);
            });
    }
  </script>
</body>

</html>